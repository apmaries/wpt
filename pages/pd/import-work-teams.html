<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="cache-control" content="no-cache" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <title>WEM Power Tools - Import Work Teams</title>
    <link rel="icon" href="../favicon.ico" type="image/x-icon" />

    <!-- Genesys stuff https://spark.genesys.com/ -->
    <link
      href="https://dhqbrvplips7x.cloudfront.net/common-ui-docs/genesys-webcomponents/3.8.1-178/genesys-webcomponents/genesys-webcomponents.css"
      rel="stylesheet"
    />
    <script
      type="module"
      src="https://dhqbrvplips7x.cloudfront.net/common-ui-docs/genesys-webcomponents/3.8.1-178/genesys-webcomponents/genesys-webcomponents.esm.js"
    ></script>

    <!-- External stuff -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wght@100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Urbanist:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />

    <!-- Project stuff -->
    <script>
      // Check window location protocol for test mode (https is considered production)
      const testMode = window.location.protocol === "http:" ? true : false;

      // Link to the favicon
      const faviconLink = testMode
        ? "/wpt/.test/test_favicon.ico"
        : "/wpt/favicon.ico";
      const favicon = document.createElement("link");
      favicon.rel = "icon";
      favicon.type = "image/x-icon";
      favicon.href = faviconLink;
      document.head.appendChild(favicon);
    </script>
    <link rel="stylesheet" href="/wpt/css/style.css" />
  </head>
  <body>
    <header id="header" class="primary-section">
      <nav style="border: red solid">
        <div class="sub-section-065">
          <ul id="nav-items">
            <h1 id="title">
              WEM Power Tools
              <svg id="banner" width="4000" height="50" viewBox="0 0 5000 250">
                <g transform="translate(100 0) rotate(180, -2475, 0)">
                  <path
                    id="API-expanded"
                    d="M151.93,167.356v18.928a69.538,69.538,0,0,1-63.091,69.145v41.244a6.345,6.345,0,1,1-12.691,0v-47.3a6.345,6.345,0,0,1,6.345-6.345,56.809,56.809,0,0,0,56.746-56.74V173.7H25.748v12.583a56.987,56.987,0,0,0,23.23,45.794,6.345,6.345,0,1,1-7.494,10.241A69.722,69.722,0,0,1,13.057,186.29V167.356a6.345,6.345,0,0,1,6.345-6.345H57.22V116.365a6.345,6.345,0,0,1,12.691,0v44.645H95.076V116.365a6.345,6.345,0,1,1,12.691,0v44.645h37.818A6.345,6.345,0,0,1,151.93,167.356ZM88.839,47.766V6.477a6.345,6.345,0,0,0-12.691,0V47.766a69.513,69.513,0,0,0-63.091,69.113v18.934a6.345,6.345,0,0,0,6.345,6.345H38.33a6.345,6.345,0,1,0,0-12.691H25.748V116.879a56.746,56.746,0,1,1,113.492,0v12.589H126.657a6.345,6.345,0,1,0,0,12.691h18.928a6.345,6.345,0,0,0,6.345-6.345V116.879A69.513,69.513,0,0,0,88.839,47.766Z"
                    transform="translate(0 0) rotate(-90)"
                    fill="#ff4f1f"
                  />
                  <!-- Extending straight lines -->
                  <line
                    x1="300"
                    y1="-82.5"
                    x2="5000"
                    y2="-82.5"
                    stroke="#ff4f1f"
                    stroke-width="13"
                  />
                  <line
                    x1="-7000"
                    y1="-82.5"
                    x2="10"
                    y2="-82.5"
                    stroke="#ff4f1f"
                    stroke-width="13"
                  />
                </g>
              </svg>
            </h1>
            <!-- Nav items are dynamically added by nav.js -->
          </ul>
        </div>
        <div class="sub-section-035"></div>
      </nav>
      <div id="breadcumbs-container" style="border: red solid">
        <gux-breadcrumbs id="breadcrumbs" accent="primary">
          <!-- Breadcrumbs added dynamically by breadcrumbs.js -->
        </gux-breadcrumbs>
      </div>

      <div id="subheader" style="border: red solid">
        <p id="authenticatedSubHeader">User Name authenticated in: Org Name</p>
        <p>
          <gux-button id="disconnectButton" accent="primary">
            Disconnect
          </gux-button>
        </p>
      </div>
    </header>
    <main>
      <section id="info-section" class="primary-section">
        <div id="tool-info-div" class="sub-section-035">
          <!-- Tool info is dynamically added by tools.js -->
        </div>
      </section>

      <!-- action section-->
      <section
        id="action-section"
        class="Row"
        style="
          box-sizing: border-box;
          border: 4px solid var(--gux-electric-purple-sec);
          background-color: var(--gux-grey-100);
        "
      >
        <!-- input group -->
        <div id="input-grp" class="Row">
          <!--file-->
          <div
            id="file"
            class="Column"
            style="
              background-color: var(--gux-grey-100);
              padding-left: 40px;
              border-bottom-width: 10px solid var(--gux-grey-100);
              border-top-left-radius: 10px;
            "
          >
            <div class="align-content-left">
              <h2>File to Upload</h2>
              <button id="importExample" type="button" class="import-example">
                (example)
              </button>
              <script src="../js/exportMaker.js"></script>
            </div>
            <!-- file name / browse button -->
            <div id="file-div" hidden>
              <input
                id="file-name"
                type="text"
                class="file-input"
                placeholder="File to import"
                style="height: 28px; width: 250px"
              />
              <gux-button
                disabled
                id="importFile"
                for="fileInput"
                accent="primary"
                style="display: inline-block; width: 100px"
                >Browse</gux-button
              >
              <input
                id="fileInput"
                class="file-input"
                type="file"
                accept=".csv"
                style="display: none"
              />
            </div>
            <gux-loading-message-beta
              id="loading-message"
              style="display: block"
            >
              <div slot="primary-message">Loading existing Work Teams...</div>
              <gux-page-loading-spinner
                id="loading-message"
                screenreader-text="Loading existing work teams"
                style="width: 200px"
              ></gux-page-loading-spinner>
            </gux-loading-message-beta>
          </div>

          <div
            id="variables"
            class="Column"
            style="
              background-color: var(--gux-grey-100);
              border-bottom-width: 10px solid var(--gux-grey-100);
              position: relative;
              bottom: 0%;
            "
          >
            <fieldset
              id="import-method"
              class="align-content"
              style="padding-top: 30px"
            >
              <legend>Log level</legend>
              <gux-form-field-radio>
                <input
                  slot="input"
                  type="radio"
                  name="log-level"
                  value="DEBUG"
                />
                <label slot="label">DEBUG</label>
              </gux-form-field-radio>

              <gux-form-field-radio>
                <input
                  slot="input"
                  type="radio"
                  name="log-level"
                  value="INFO"
                  checked="checked"
                />
                <label slot="label">INFO</label>
              </gux-form-field-radio>

              <gux-form-field-radio>
                <input
                  slot="input"
                  type="radio"
                  name="log-level"
                  value="WARNING"
                />
                <label slot="label">WARNING</label>
              </gux-form-field-radio>
            </fieldset>

            <!--options-->
            <form>
              <fieldset>
                <legend>Resolve conflicts by</legend>

                <gux-form-field-radio>
                  <input
                    slot="input"
                    type="radio"
                    name="resolve-method"
                    value="replace"
                    checked
                  />
                  <label slot="label"
                    >Replace - move agent to team listed in file if currently
                    different</label
                  >
                </gux-form-field-radio>

                <gux-form-field-radio>
                  <input
                    slot="input"
                    type="radio"
                    name="resolve-method"
                    value="retain"
                  />
                  <label slot="label"
                    >Retain - keep agent in existing team if different to
                    file</label
                  >
                </gux-form-field-radio>
              </fieldset>
            </form>
          </div>

          <!--buttons-->
          <div
            id="buttons"
            class="Column"
            style="
              position: relative;
              background-color: var(--gux-grey-100);
              border-bottom-width: 10px solid var(--gux-grey-100);
              border-top-right-radius: 10px;
            "
          >
            <div
              id="button-container"
              class="align-content"
              style="
                position: absolute;
                align-items: center;
                bottom: 1%;
                right: 15%;
              "
            >
              <gux-button
                disabled
                id="clear-button"
                onclick="reset()"
                style="display: inline-block; width: 100px; position: relative"
              >
                <gux-icon
                  icon-name="trashcan"
                  screenreader-text="Clear terminal"
                ></gux-icon>
                <span>Clear</span>
              </gux-button>

              <gux-action-button
                disabled
                id="export-button"
                text="Export"
                accent="tertiary"
                style="display: inline-block; position: relative"
              >
                <gux-list-item onclick="exportLogs()"
                  >Export logs</gux-list-item
                >
                <gux-list-item onclick="exportIgnoredRecords()"
                  >Export invalid records</gux-list-item
                >
              </gux-action-button>

              <gux-button
                disabled
                id="import-button"
                accent="primary"
                style="display: inline-block; width: 100px; position: relative"
                >Import</gux-button
              >
            </div>
          </div>
        </div>

        <!--terminal-->
        <div
          id="terminal-grp"
          class="Row process-grp"
          style="margin-bottom: 0px"
        >
          <div id="terminal" class="terminal"></div>
        </div>
      </section>
    </main>

    <!--Import button event listener-->
    <script type="module">
      import { processData } from "../js/pd_importWorkTeams.js";
      // add event listener to import button
      const importBtn = document.getElementById("import-button");
      importBtn.addEventListener("click", processData);
    </script>

    <!--Clear terminal & reset-->
    <script>
      function reset() {
        document.getElementById("file-name").value = "";
        document
          .getElementById("importFile", "")
          .removeAttribute("disabled", "disabled");
        document
          .getElementById("export-button", "")
          .setAttribute("disabled", "disabled");
        document
          .getElementById("import-button", "")
          .setAttribute("disabled", "disabled");

        clearTerminal("pdImpWtsData", "pdImpWtsIgnored");
        terminal(`Import Work Teams`, "INFO");
        terminal("Previous terminal data cleared", "DEBUG");
        let wtCount = JSON.parse(sessionStorage.getItem("pdWorkTeamsList"));
        terminal(`${wtCount.length} Work Teams already in memory`, "INFO");
        terminal(`Ready for file`, "INFO");
      }
    </script>

    <script>
      // example file download
      const example = async function () {
        // example data
        const data = [
          {
            "Division": "Home",
            "Team Name": "Team 1",
            "Agent Email": "amAgent01@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 1",
            "Agent Email": "amAgent02@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 1",
            "Agent Email": "amAgent03@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 1",
            "Agent Email": "amAgent04@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 1",
            "Agent Email": "amAgent05@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 1",
            "Agent Email": "amAgent06@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 1",
            "Agent Email": "amAgent07@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 1",
            "Agent Email": "amAgent08@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 1",
            "Agent Email": "amAgent09@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 1",
            "Agent Email": "amAgent10@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 2",
            "Agent Email": "amAgent11@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 2",
            "Agent Email": "amAgent12@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 2",
            "Agent Email": "amAgent13@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 2",
            "Agent Email": "amAgent14@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 2",
            "Agent Email": "amAgent15@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 2",
            "Agent Email": "amAgent16@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 2",
            "Agent Email": "amAgent17@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 2",
            "Agent Email": "amAgent18@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 2",
            "Agent Email": "amAgent19@domain.com",
          },
          {
            "Division": "Home",
            "Team Name": "Team 2",
            "Agent Email": "amAgent20@domain.com",
          },
        ];

        const csvdata = csvMaker(data);
        download(csvdata, "importWorkTeams_example.csv", "text/csv");
      };

      // add event listener to example button
      const exampleBtn = document.getElementById("importExample");
      exampleBtn.addEventListener("click", example);

      // export all logs
      const exportLogs = function () {
        terminal(`Export logs`, "INFO");
        logs = document.getElementsByClassName("log-entry");
        logEntries = [];
        for (let l = 0; l < logs.length; l++) {
          logEntry = logs[l].innerHTML;
          logEntries.push(logEntry);
        }
        const logData = logMaker(logEntries);
        download(logData, "importWorkTeams.log", "text/plain");
      };

      // export ignored data
      function exportIgnoredRecords() {
        terminal(`Exporting ignored records`, "INFO");
        let exportData = sessionStorage.getItem("pdImpWtsIgnored");
        if (exportData) {
          const csvdata = csvMaker(JSON.parse(exportData));
          download(csvdata, "importWorkTeams_ignored.csv", "text/csv");
        } else {
          terminal(`No ignored records to export`, "WARNING");
        }
      }
    </script>
    <footer>
      <p>
        Questions? Requests? Problems? Let me know by
        <a
          href="mailto:andy.maries@genesys.com?subject=WPT%20Feedback"
          style="color: #ff4c1c"
          >email</a
        >
      </p>
    </footer>
    <!-- Load the PureCloud platform client library -->
    <script src="https://sdk-cdn.mypurecloud.com/javascript/latest/purecloud-platform-client-v2.min.js"></script>

    <!-- Load the nav.js module -->
    <script src="/wpt/js/components/nav.js" defer></script>

    <!-- Load the breadcrumbs.js module -->
    <script src="/wpt/js/components/breadcrumbs.js" defer></script>

    <!-- Load the tools.js module -->
    <script type="module" src="/wpt/js/components/tools.js" defer></script>

    <!-- Load the session.js module -->
    <script type="module" src="/wpt/js/utils/session.js" defer></script>

    <!-- Load the disconnect.js module -->
    <script type="module" src="/wpt/js/utils/disconnect.js" defer></script>

    <script>
      // Return home if title clicked
      document.getElementById("title").addEventListener("click", () => {
        window.location.href = "/wpt/wpt-home.html";
      });
    </script>
  </body>
</html>
